---
- name: Install and Configure HTTPD
  hosts: all
  become: true
  vars:
    s3_image_url: "https://group-7-dev.s3.us-east-1.amazonaws.com/Group7.jpg?response-content-disposition=inline&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEG0aCXVzLWVhc3QtMSJIMEYCIQDi0wigRy5qVRcnu%2BwY6yzBiDVxz2qlBpbg5ZlhhE3NFAIhAJm6xTCAyRjv3EkbF1eeY6SaTB%2FQedALmquAnXHT5xC2KtADCCYQABoMMzkxMzU2NjI3NTg3IgxHo7gifPQPp29zrKUqrQNbtBd%2FqWdk%2FWLLwbo909KfPnBn929%2BQKI6YGLhqyXTDH8vpCNVrgWGq9BYoJDAZkbMC7hfHGIJPJVba0uhkVnLtg%2BvY%2FrCacq87oQrcZxny%2ByhIcZq6bMpsfxnVigFwVQHvjziSI3a%2BJnMi2bsMLDFeyjVH09LOjgneKyTVW2oNbMV5kflJwDPEXn4OzY4bH3n4hUUCv3KsduvxXfEWpZKceq39toMQhuif77qy5UwOIQ6AOW6wfaQscqWCA8IXVZTCbu1XV5lhaxVvf2qPLJhggaPJS1EA2L%2BE4S%2BOCNar5r%2FuFPLVmSMqba%2Faej2HCE2fjfjmV9x3gM6xbzFWMOPLWdvs5lzkiKHR7%2Ft7%2B3%2BykT7TQk2yRiNoTSw%2BTJ31%2BTVfj03MQyX%2BBYqgRww5zmhdIP7rf2tLQMrps4eOoxQJtRs8umWZgD0lTeqrrKFrZFy2V3bUBtIZ1oIfY1ngs9sKU%2FhOvsIeTDmJq0bmwl7DIHtsxkvWHVi%2BQ%2BuUTMOC7auLRmOlrXuVbQTQQEOZX1NW7b7UBZGdsjDeiPExOgb%2BdM7jdtA8IsdbDySdtIwhfzJugY6tgKNFROIwbesAVqnbVveW3desllvlrPhCPRJdiOTvlZD7oO%2FlRvTsLhCeSbC%2Fglk0iR4ennG8h3MzSswwCjMoRWqU%2BFK2mhzTjkWjasf7i5AWPfKl6yRCFej6v%2Bp7567Vt1QXWzAZAo%2Ba2yJDoNM71Y4e%2FGxvoU9olmK0nnGEMjgvR%2Byzf0NEBopO1GNoyvF6uUihoU0Sn3pYT4jj8teMAKK9JGn%2BUIghPFE2oqlZ81YtelZlA7RbIZIq0uYGEXGaf52yEe6vHcYQeAw3Cw0TOtcorNMx8C38cD%2FmtseaziLRLi%2F%2FCLyNIq483%2FkeOAB%2BJSDOmQREXZHv25lc3YOThTBakWlw7UM%2F2UHPDnL6L9MCseV4UGrGl%2FVRei4FslXl7zbLrZnBDmLTaRq2LtQ2i23sK0nwwV%2F&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAVWHVMHKB5HLCINDE%2F20241206%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20241206T044234Z&X-Amz-Expires=14400&X-Amz-SignedHeaders=host&X-Amz-Signature=7e2a369ff20f4c7b64032b6bd687e525654c2f5b5d9c789563b83d2dca132131"
    team_members:
      - "Ishan Sohal"
      - "Vishnu Reghunath"
      - "Rony Hopeman"
      - "Yash Gujral"
  tasks:
    - name: Update the system packages
      yum:
        name: '*'
        state: latest

    - name: Install HTTPD
      yum:
        name: httpd
        state: present

    - name: Start and enable HTTPD service
      service:
        name: httpd
        state: started
        enabled: true

    - name: Fetch local IPv4 address
      uri:
        url: http://169.254.169.254/latest/meta-data/local-ipv4
        return_content: yes
      register: local_ipv4

    - name: Fetch Instance ID
      uri:
        url: http://169.254.169.254/latest/meta-data/instance-id
        return_content: yes
      register: instance_id

    - name: Fetch Availability Zone
      uri:
        url: http://169.254.169.254/latest/meta-data/placement/availability-zone
        return_content: yes
      register: availability_zone

    - name: Get current server time
      shell: date
      register: current_time

    - name: Create the index.html file from template
      template:
        src: index.html.j2
        dest: /var/www/html/index.html
      vars:
        myip: "{{ local_ipv4.content }}"
        instance_id: "{{ instance_id.content }}"
        availability_zone: "{{ availability_zone.content }}"
        current_time: "{{ current_time.stdout }}"

    - name: Ensure proper permissions for the web directory
      file:
        path: /var/www/html
        state: directory
        mode: '0755'
        recurse: yes
